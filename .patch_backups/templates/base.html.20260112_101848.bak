<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{{ title or "SME Early-Warning" }}</title>

  <!-- Icons -->
  <link rel="icon" href="/static/favicon.ico">
  <link rel="apple-touch-icon" href="/static/apple-touch-icon.png">

  <!-- Styles -->
  <link rel="stylesheet" href="/static/styles.css">
</head>

<body>
  <header class="nav">
    <div class="nav-inner">
      <div class="brand">
        <div>SME Early-Warning</div>
        <small>Prototype • Audit-trail alerts</small>
      </div>

      <nav class="nav-links">
      {# Defensive: never assume request/run_qs are present #}
      {% set path = request.url.path if request is defined and request.url is defined else '' %}
      {% set rq_raw = run_qs if run_qs is defined and run_qs else '' %}
      {# Ensure rq is either "" or begins with "?" #}
      {% set rq = rq_raw if (rq_raw and rq_raw.startswith('?')) else ('?' ~ rq_raw) if rq_raw else '' %}

        <a href="/dashboard{{ rq }}"
           class="{{ 'active' if path in ['/', '/home', '/dashboard'] else '' }}">
          Home
        </a>

        <a href="/alerts{{ rq }}"
           class="{{ 'active' if path.startswith('/alerts') else '' }}">
          Alerts
        </a>

        <a href="/insights{{ rq }}"
           class="{{ 'active' if path.startswith('/insights') or path.startswith('/digest') else '' }}">
          Insights
        </a>

        <a href="/history{{ rq }}"
           class="{{ 'active' if path.startswith('/history') else '' }}">
          History
        </a>

        <a href="/settings{{ rq }}"
           class="{{ 'active' if path.startswith('/settings') else '' }}">
          Settings
        </a>

        {# Upload button ONLY on Home + Upload pages #}
        {% if path in ['/', '/home', '/dashboard', '/upload'] %}
          <a href="/upload" class="btn btn-sm btn-primary">
            Upload
          </a>
        {% endif %}
      </nav>
    </div>
  </header>

  
      {% if active_run_id is defined and latest_run_id is defined and active_run_id and latest_run_id and (active_run_id != latest_run_id) %}
        <div class="run-badge">
          Viewing run <strong class="mono">#{{ active_run_id }}</strong> (not latest)
          <a class="link" style="margin-left:10px;" href="/latest">Return to latest</a>
        </div>
      {% endif %}

  <main class="container">
    {% block content %}{% endblock %}

    <div class="footer">
      <div class="hr"></div>
      <div>
        <strong>Disclaimer:</strong>
        Software-generated insights based on uploaded data.
        Not financial advice. Validate decisions with a qualified professional.
      </div>
      <div>
        Design goal:
        <strong>explainable signals + audit trail + tunable thresholds</strong>
        (avoid black-box “confidence” claims).
      </div>
    </div>
  </main>

  <script src="/static/app.js"></script>
</body>
</html>
