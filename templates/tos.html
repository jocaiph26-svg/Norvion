{% extends "base.html" %}
{% block content %}
  <div class="header">
    <div>
      <h1 class="h1">Terms of Service</h1>
      <p class="sub">Version {{ tos_version }} - Please review and accept to continue</p>
    </div>
  </div>

  {% if request.query_params.get('error') == 'csrf' %}
    <div class="card" style="background:#fef2f2; border-left:4px solid #ef4444; margin-bottom:16px;">
      <div class="card-b" style="padding:12px 16px;">
        <strong>Session verification failed.</strong> Please try accepting again.
      </div>
    </div>
  {% endif %}

  {% if already_accepted %}
    <div class="card" style="background:var(--bg-success, #d4edda); border-left:4px solid var(--success, #28a745); margin-bottom:16px;">
      <div class="card-b" style="padding:12px 16px;">
        <strong>You have already accepted this version of the Terms of Service.</strong>
      </div>
    </div>
  {% endif %}

  <div class="card">
    <div class="card-b">
      <h2>Important Disclaimer</h2>
      <div class="hr"></div>
      <div style="max-height:400px; overflow-y:auto; padding:12px; background:var(--bg-muted, #f8f9fa); border-radius:4px; margin-bottom:16px;">

        <h3 style="margin-top:0;">1. Not Financial Advice</h3>
        <p><strong>Norvion is NOT financial advice.</strong> This tool provides deterministic analysis of uploaded transaction data for informational purposes only. It does not:</p>
        <ul style="margin:8px 0 16px 20px;">
          <li>Predict future business outcomes</li>
          <li>Make autonomous decisions on your behalf</li>
          <li>Provide investment, accounting, tax, or legal advice</li>
          <li>Replace professional financial consultation</li>
        </ul>

        <h3>2. Deterministic Analysis</h3>
        <p>All alerts and metrics are computed using fixed, auditable rules based solely on the data you upload. The system:</p>
        <ul style="margin:8px 0 16px 20px;">
          <li>Uses no AI/ML prediction or scoring</li>
          <li>Applies consistent rules across all runs</li>
          <li>Produces repeatable results for identical inputs</li>
          <li>Does not learn or adapt from your data</li>
        </ul>

        <h3>3. Data Processing</h3>
        <p>Your uploaded transaction data is processed locally within this deployment. We do not:</p>
        <ul style="margin:8px 0 16px 20px;">
          <li>Transmit data to external AI services for analysis</li>
          <li>Share data with third parties</li>
          <li>Use your data to train models</li>
        </ul>

        <h3>4. Limitation of Liability</h3>
        <p>The information provided by this tool is for general informational purposes only. <strong>You are solely responsible for any decisions made based on this information.</strong></p>
        <p>Use your organization's review process for any decisions based on this information. This tool is designed to surface patterns in your data, not to advise on actions.</p>

        <h3>5. Accuracy</h3>
        <p>While we strive for accurate calculations, results depend on the quality and completeness of the data you upload. Data quality issues (missing fields, incorrect formats, incomplete records) may affect analysis accuracy.</p>

        <h3>6. Updates to Terms</h3>
        <p>These terms may be updated from time to time. You will be asked to review and accept new versions when they are published.</p>

      </div>

      <form method="POST" action="/tos" style="margin-top:16px;">
        {% if csrf_token %}<input type="hidden" name="csrf_token" value="{{ csrf_token }}">{% endif %}
        {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}
        <div style="display:flex; align-items:center; gap:16px;">
          <button type="submit" class="btn" {% if already_accepted %}disabled style="opacity:0.5; cursor:not-allowed;"{% endif %}>{% if already_accepted %}Already Accepted{% else %}I Accept These Terms{% endif %}</button>
          <button type="button" onclick="this.form.action='/logout'; this.form.submit();" style="background:none; border:none; color:var(--muted); text-decoration:none; cursor:pointer; padding:0; font:inherit;">Decline &amp; Logout</button>
        </div>
      </form>
    </div>
  </div>

  <div class="card" style="margin-top:16px;">
    <div class="card-b">
      <h2>Summary</h2>
      <div class="hr"></div>
      <table style="width:100%; border-collapse:collapse;">
        <tbody>
          <tr>
            <td style="padding:6px 0; font-weight:800; width:180px;">TOS Version</td>
            <td style="padding:6px 0;"><span class="mono">{{ tos_version }}</span></td>
          </tr>
          <tr>
            <td style="padding:6px 0; font-weight:800;">Key Point</td>
            <td style="padding:6px 0;">This tool is for informational purposes only. Not financial advice.</td>
          </tr>
          <tr>
            <td style="padding:6px 0; font-weight:800;">Analysis Type</td>
            <td style="padding:6px 0;">Deterministic, rule-based (no AI/ML prediction)</td>
          </tr>
          <tr>
            <td style="padding:6px 0; font-weight:800;">Your Responsibility</td>
            <td style="padding:6px 0;">All decisions based on this tool's output</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}
