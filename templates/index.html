{% extends "base.html" %}
{% block content %}
  <div class="header">
    <div>
      <h1 class="h1">Upload transactions CSV</h1>
      <p class="sub">
        Generates a deterministic run snapshot and stored alert records (no AI required).
        Output shows stored evidence for each alert.
      </p>
    </div>
  </div>

  {# Optional: render an error message if backend provides `error` #}
  {% if error %}
    <div class="card">
      <div class="card-b">
        <div class="callout">
          <strong>Upload failed.</strong> {{ error }}
        </div>
      </div>
    </div>
    <div style="height:14px;"></div>
  {% endif %}

  {# Optional: render a success/info message if backend provides `message` #}
  {% if message %}
    <div class="card">
      <div class="card-b">
        <div class="callout">
          <strong>{{ message }}</strong>
        </div>
      </div>
    </div>
    <div style="height:14px;"></div>
  {% endif %}

  <div class="grid cols-2">
    <div class="card">
      <div class="card-b">
        <h2>Upload-time defaults (read-only)</h2>
        <div class="hr"></div>
        <div class="row">
          <div class="pill">Currency: {{ s.currency }}</div>
          <div class="pill">Starting cash: {{ s.starting_cash|money(s.currency) }}</div>
          <div class="pill">Window: {{ s.window_days|num(0) }} days</div>
          <div class="pill">Burn window: {{ s.burn_days|num(0) }} days</div>
        </div>
        <div style="margin-top:12px;">
          <span class="small" style="color:var(--muted);">
            Defaults are recorded at run time for each upload.
          </span>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-b">
        <form action="/analyze" method="post" enctype="multipart/form-data">
          <div class="field">
            <label>CSV file</label>
            <input class="input" type="file" name="file" accept=".csv" required>
            <div class="small" style="color:var(--muted); font-size:12px; margin-top:6px;">
              Required: <strong>date, amount</strong>. Optional: type, category, counterparty, description, invoice_id, due_date, status, direction.
            </div>
          </div>

          <div class="row" style="margin-top:14px;">
            <button class="btn primary" type="submit">Create run snapshot</button>
            <a class="btn" href="/latest">View latest</a>
          </div>
        </form>

        <div class="hr"></div>
        <div class="callout">
          Built for auditability: shows stored evidence behind each alert.
        </div>
      </div>
    </div>
  </div>
{% endblock %}
